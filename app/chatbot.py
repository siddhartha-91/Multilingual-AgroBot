def chatbot_reply(message, crop, disease, language="en"):
    msg = message.lower().strip()

    # üîë KEYWORDS (language-aware)
    treatment_keywords = {
        "en": ["treat", "treatment", "medicine"],
        "te": ["‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏", "‡∞ü‡±ç‡∞∞‡±Ä‡∞ü‡±ç‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç", "‡∞Æ‡∞Ç‡∞¶‡±Å"],
        "hi": ["‡§á‡§≤‡§æ‡§ú", "‡§¶‡§µ‡§æ", "‡§â‡§™‡§ö‡§æ‡§∞"],
        "kn": ["‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü", "‡≤Æ‡≤¶‡≥ç‡≤¶‡≥Å"]
    }

    symptom_keywords = {
        "en": ["symptom", "sign"],
        "te": ["‡∞≤‡∞ï‡±ç‡∞∑‡∞£", "‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å"],
        "hi": ["‡§≤‡§ï‡•ç‡§∑‡§£"],
        "kn": ["‡≤≤‡≤ï‡≥ç‡≤∑‡≤£"]
    }

    prevention_keywords = {
        "en": ["prevent", "avoid", "prevention"],
        "te": ["‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£", "‡∞§‡∞™‡±ç‡∞™‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø"],
        "hi": ["‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ", "‡§¨‡§ö‡§æ‡§µ"],
        "kn": ["‡≤§‡≤°‡≥Ü", "‡≤§‡≤°‡≥Ü‡≤Ø‡≤≤‡≥Å"]
    }

    lang = language if language in treatment_keywords else "en"

    def contains(keywords):
        return any(k in msg for k in keywords)

    # ‚úÖ TREATMENT RESPONSE
    if contains(treatment_keywords[lang]):
        responses = {
            "en": f"{disease} treatment: Spray neem oil or sulfur fungicide. Remove infected leaves.",
            "te": f"{disease} ‡∞ï‡±Å ‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏‡∞ó‡∞æ ‡∞µ‡±á‡∞™ ‡∞®‡±Ç‡∞®‡±Ü ‡∞≤‡±á‡∞¶‡∞æ ‡∞ó‡∞Ç‡∞ß‡∞ï‡∞Ç ‡∞∏‡±ç‡∞™‡±ç‡∞∞‡±á ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞ø. ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Æ‡±à‡∞® ‡∞Ü‡∞ï‡±Å‡∞≤‡∞®‡±Å ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
            "hi": f"{disease} ‡§ï‡•á ‡§â‡§™‡§ö‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§Æ ‡§§‡•á‡§≤ ‡§Ø‡§æ ‡§∏‡§≤‡•ç‡§´‡§∞ ‡§ï‡§æ ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å ‡§π‡§ü‡§æ‡§è‡§Å‡•§",
            "kn": f"{disease} ‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü‡≤ó‡≤æ‡≤ó‡≤ø ‡≤®‡≥Ä‡≤Æ‡≥ç ‡≤é‡≤£‡≥ç‡≤£‡≥Ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ó‡≤Ç‡≤ß‡≤ï‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø. ‡≤∏‡≥ã‡≤Ç‡≤ï‡≤ø‡≤§ ‡≤é‡≤≤‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤π‡≤æ‡≤ï‡≤ø."
        }
        return responses[lang]

    # ‚úÖ SYMPTOMS RESPONSE
    if contains(symptom_keywords[lang]):
        responses = {
            "en": f"Symptoms: white powdery spots on {crop} leaves.",
            "te": f"‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å: {crop} ‡∞Ü‡∞ï‡±Å‡∞≤‡∞™‡±à ‡∞§‡±Ü‡∞≤‡±ç‡∞≤‡∞ü‡∞ø ‡∞™‡±ä‡∞°‡∞ø ‡∞Æ‡∞ö‡±ç‡∞ö‡∞≤‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø.",
            "hi": f"‡§≤‡§ï‡•ç‡§∑‡§£: {crop} ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§∏‡§´‡•á‡§¶ ‡§™‡§æ‡§â‡§°‡§∞ ‡§ú‡•à‡§∏‡•á ‡§ß‡§¨‡•ç‡§¨‡•á‡•§",
            "kn": f"‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≥Å: {crop} ‡≤é‡≤≤‡≥Ü‡≤ó‡≤≥ ‡≤Æ‡≥á‡≤≤‡≥Ü ‡≤¨‡≤ø‡≤≥‡≤ø ‡≤™‡≥Å‡≤°‡≤ø ‡≤Æ‡≤ö‡≥ç‡≤ö‡≥Ü‡≤ó‡≤≥‡≥Å."
        }
        return responses[lang]

    # ‚úÖ PREVENTION RESPONSE
    if contains(prevention_keywords[lang]):
        responses = {
            "en": "Prevention: avoid overhead watering and keep plant spacing.",
            "te": "‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£: ‡∞™‡±à ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞®‡±Ä‡∞∞‡±Å ‡∞™‡±ã‡∞Ø‡∞°‡∞Ç ‡∞§‡∞™‡±ç‡∞™‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞Æ‡∞ß‡±ç‡∞Ø ‡∞¶‡±Ç‡∞∞‡∞Ç ‡∞â‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
            "hi": "‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ: ‡§ä‡§™‡§∞ ‡§∏‡•á ‡§™‡§æ‡§®‡•Ä ‡§® ‡§°‡§æ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§¶‡•Ç‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç‡•§",
            "kn": "‡≤§‡≤°‡≥Ü: ‡≤Æ‡≥á‡≤≤‡≥ç‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ó‡≤ø‡≤°‡≤ó‡≤≥ ‡≤®‡≤°‡≥Å‡≤µ‡≥Ü ‡≤Ö‡≤Ç‡≤§‡≤∞ ‡≤ï‡≤æ‡≤Ø‡≤ø‡≤∞‡≤ø."
        }
        return responses[lang]

    # ‚úÖ FALLBACK (VERY IMPORTANT)
    fallback = {
        "en": "Please ask about treatment, symptoms, or prevention.",
        "te": "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏, ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£ ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø.",
        "hi": "‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§≤‡§æ‡§ú, ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§Ø‡§æ ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§",
        "kn": "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü, ‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤§‡≤°‡≥Ü ‡≤ï‡≥Å‡≤∞‡≤ø‡≤§‡≥Å ‡≤ï‡≥á‡≤≥‡≤ø."
    }
    return fallback[lang]
